
# אנליסט AI לדשבורד הניהול

## מה ייבנה
הטאב "AI Insights" יוחלף באנליסט AI חכם שמנתח את כל הנתונים במערכת ומחזיר תובנות עסקיות למנכ"ל. לחיצה על כפתור "נתח את הנתונים" תשלח את כל המטריקות ל-OpenAI ותקבל בחזרה ניתוח מפורט בעברית.

## איך זה עובד

1. **לחיצה על כפתור** - אוסף את כל הנתונים מה-DB (הנתונים שכבר נטענים בדשבורד + שאילתות נוספות)
2. **שליחה ל-Edge Function** - מעביר את הנתונים ל-GPT-4o-mini עם System Prompt של "דאטה אנליסט למנכ"ל"
3. **תצוגת תובנות** - מציג את התשובה בעברית, מעוצבת בכרטיסים

## אילו נתונים ינותחו
- מספר הורים רשומים, ילדים, מכשירים מחוברים
- שיעור המרה מרשימת המתנה
- Funnel (waitlist -> registered -> child -> device -> active)
- התראות היום (כמות, סוגים, קריטיות)
- מגמת התראות 14 יום
- Feedback engagement rate
- בריאות תור ההתראות (pending, failed)
- הודעות שנסרקו היום
- משתמשים פעילים / לא פעילים
- משתמשים ללא מכשיר מחובר

## פרטים טכניים

### Edge Function חדשה: `supabase/functions/admin-ai-analyst/index.ts`
- מקבלת JSON עם כל המטריקות מהקליינט
- מוודאת שהקורא הוא אדמין (בדיקת JWT + user_roles)
- שולחת ל-OpenAI GPT-4o-mini עם System Prompt:
  - "אתה דאטה אנליסט בכיר בחברת סטארטאפ. תפקידך לנתח נתונים ולתת תובנות עסקיות למנכ"ל בעברית."
  - הנחיות: זהה מגמות, חריגות, הזדמנויות, סיכונים, והמלצות לפעולה
- מחזיר תשובה כ-JSON מובנה (כותרת ראשית, רשימת תובנות, המלצות)
- משתמש ב-`OPENAI_API_KEY` שכבר מוגדר

### קומפוננטה חדשה: `src/pages/admin/AdminAIAnalyst.tsx`
- מחליפה את `AdminInsightStats`
- כפתור "נתח את הנתונים" (עם אנימציית טעינה)
- מציגה תובנות בכרטיסים מעוצבים לפי קטגוריה
- מציגה את התשובה ב-Markdown
- מקבלת את `overviewStats`, `users`, `waitlist` כ-props

### שינויים ב-`src/pages/Admin.tsx`
- החלפת import של `AdminInsightStats` ב-`AdminAIAnalyst`
- העברת הנתונים הקיימים לקומפוננטה החדשה
- שינוי שם הטאב ל-"אנליסט AI"

### הוספה ל-`supabase/config.toml`
- הגדרת `[functions.admin-ai-analyst]` עם `verify_jwt = false`
