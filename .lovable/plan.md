

# עיצוב מחדש של הגדרות התראות

## מצב נוכחי -- הבעיות

1. **הסליידר לא באמת עושה כלום** -- ה-view `parent_alerts_effective` משתמש בערכים קבועים (60 רגיל, 80 warmup) ומתעלם מ-`alert_threshold` בטבלת settings
2. **סליידר 0-100 מבלבל** -- הורה לא יודע מה זה "70" ומה ההבדל בין 65 ל-75
3. **מילות טריגר** -- המתג לא עושה כלום אמיתי, צריך לחשוב על זה כפיצ'ר נפרד

## הפתרון

### חלק 1: רמות רגישות (במקום סליידר)

שלוש אופציות ברורות שההורה יכול לבחור:

| רמה | שם | ערך threshold | משמעות |
|-----|-----|---------------|---------|
| רגיש | "רגיש -- כל חשד" | 50 | גם אירועים ברמת סיכון בינונית יגיעו אליך |
| מאוזן | "מאוזן -- מומלץ" (ברירת מחדל) | 65 | התראות על אירועים משמעותיים בלבד |
| חמור בלבד | "רק חמור" | 85 | רק אירועים חמורים באמת |

העיצוב: שלושה כפתורים בשורה, הנבחר מודגש, עם תיאור קצר מתחת.

### חלק 2: חיבור ה-threshold לדאטאבייס

כדי שהבחירה תשפיע באמת, נעדכן את ה-view `parent_alerts_effective` כך שישתמש ב-`alert_threshold` מטבלת `settings` (אם קיים) במקום בערכים הקבועים.

### חלק 3: הסרת מילות טריגר (לעת עתה)

מילות טריגר מותאמות אישית הן פיצ'ר שדורש פיתוח צד-מכשיר (זיהוי המילים, שליחת התראה מיידית בלי AI). נסיר את המתג הנוכחי שלא עושה כלום, ונשאיר את זה כפיצ'ר עתידי.

### חלק 4: מה נשאר בדף

1. **רמת רגישות** -- 3 כפתורים לבחירה (במקום סליידר)
2. **התראה על אנשי קשר לא מוכרים** -- נשאר (מתג toggle)
3. **ניטור פעיל** -- נשאר (מתג toggle)

## פירוט טכני

### קבצים שישתנו

| קובץ | שינוי |
|-------|-------|
| `src/pages/NotificationSettings.tsx` | החלפת סליידר ב-3 כפתורי בחירה, הסרת מילות טריגר |
| `supabase/migrations/new_migration.sql` | עדכון view `parent_alerts_effective` לשימוש ב-`alert_threshold` מ-settings |

### עדכון ה-View

ה-view החדש יבדוק אם יש `alert_threshold` בטבלת `settings` עבור הילד, ואם כן -- ישתמש בו במקום בערך הקבוע 60/80:

```sql
-- במקום:
AND a.ai_risk_score >= 60
-- יהיה:
AND a.ai_risk_score >= COALESCE(s.alert_threshold, 
  CASE WHEN is_warmup THEN 80 ELSE 60 END)
```

### עיצוב כפתורי הרגישות

שלושה כפתורים בשורה אחת עם רדיו-סטייל:
- כל כפתור: אייקון + שם + תיאור קצר
- הכפתור הנבחר: רקע primary, טקסט לבן
- האחרים: רקע card רגיל

```
[  רגיש  ]  [ מאוזן (מומלץ) ]  [ רק חמור ]
 כל חשד      רק משמעותי        רק חמור באמת
```

